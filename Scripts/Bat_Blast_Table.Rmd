---
title: "Bat Blast Sample 2"
author: "Samantha Kreling"
date: "2/28/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
# Load in the data and required libraries
```{r}
library(here)
library(stringr)

sample2 <- read.delim(here::here("Results","Bat","2_S2_L001_R2_001_trimmed_referenceu_blastn.tab"), header = F)
dim(sample2)
```

# Examine Data
```{r}
tail(sample2,20)
```

# Split the String with the species name

We'll first test with copying that column into a new dataframe and then perform the action on the whole dataframe.

Note that in R '|' is a special symbol and to avoid that you will need to write "\\|"
```{r}
sample.species.raw <- as.character(sample2[,2])
str_split(sample.species.raw, "\\|") # this works so the next part should also
sample.species.2 <- sapply(strsplit(sample.species.raw,"\\|"),`[`, 2)#Yay we've successfully extracted the species names!

#Now let's execute that across the whole dataframe
sample2_with_species <- sample2
colnames(sample2_with_species) <- c("query", "sseqid","pident", "length","mismatch","gaopen","qstart","qend","sstart","send","evalue","bitscore")
sample2_with_species$sseqid <- as.character(sample2_with_species[,2])
sample2_with_species$species <- sapply(strsplit(sample2_with_species[,2],"\\|"),`[`, 2)# a little messy but it'll do the job!

## There are some entries that have a number tag situated along with it (the ones with a fourth column I think) and that is causing some duplication, so I'll need to remove that 
```

# Table
Now let's form a table that will give us counts of the different species represented in the file
```{r}

species.table <- table(sample2_with_species$species)
species.table
write.csv(species.table, "batS2R2_blast_output.csv")
```


